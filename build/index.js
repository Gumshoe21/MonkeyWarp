!function t(e,i,n){function s(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(o)return o(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[r]={exports:{}};e[r][0].call(l.exports,function(t){var i=e[r][1][t];return s(i?i:t)},l,l.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,e,i){function n(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i}function s(t,e){this.canvas=n(t,e),this.ctx=this.canvas.getContext("2d"),this._cursor={i:0,j:0},this._paper=0,this._pen=1,this._textColumn=~~(t/4),this._textLine=~~(e/6),this._textOffset=1,this._textPadding=e-6*this._textLine-this._textOffset,this.camera={x:0,y:0},this.ctx.fillStyle=this.palette[0],this.ctx.strokeStyle=this.palette[1]}function o(t,e){for(var i=[219,438,511,14016,14043,14326,14335,28032,28123,28086,28159,32704,32731,32758,32767,128,146,384,402,9344,9362,9600,9618,192,210,448,466,9408,9426,9664,9682,32767,0,8338,45,11962,5588,21157,29354,10,17556,5265,21973,1488,5312,448,13824,5268,31599,29843,29671,31143,18925,31183,31689,18735,31727,18927,1040,5136,17492,3640,5393,8359,25450,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25750,17553,13459,9402,28672,34,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25686,9362,13587,42,21845],n=0;n<e.length;n++){t.fillStyle=e[n];for(var s=0;s<i.length;s++)for(var o=i[s],r=0;r<15;r++){var a=r%3,h=~~(r/3),u=o>>r&1;1===u&&t.fillRect(3*s+a,5*n+h,1,1)}}t.fillStyle=e[0]}var r=settings.tileSize[0],a=settings.tileSize[1],h=16,u=Math.PI/2;e.exports=s,s.prototype._isTexture=!0,s.prototype.palette=["#000000","#FFFFFF"],s.prototype.tilesheet=new s(r*h,a*h),s.prototype.textCharset=new s(384,5*s.prototype.palette.length),s.prototype.resize=function(t,e){return this.canvas.width=t,this.canvas.height=e,this._textColumn=~~(t/4),this._textLine=~~(e/6),this._textOffset=1,this._cursor.i=0,this._cursor.j=0,this.clear(),this},s.prototype.setPalette=function(t){s.prototype.palette=t,s.prototype.textCharset=new s(384,5*t.length),o(s.prototype.textCharset.ctx,t)},s.prototype.setGlobalTilesheet=function(t){s.prototype.tilesheet.clear().draw(t,0,0)},s.prototype.setTilesheet=function(t){return t?(this.tilesheet===s.prototype.tilesheet&&(this.tilesheet=new s(r*h,a*h)),this.tilesheet.clear().draw(t,0,0),this):void delete this.tilesheet},s.prototype.setCamera=function(t,e){return this.camera.x=t||0,this.camera.y=e||0,this},s.prototype.sprite=function(t,e,i,n,s,o){var l=t%h,d=~~(t/h),p=this.ctx;return e=e||0,i=i||0,e=~~Math.round(e-this.camera.x),i=~~Math.round(i-this.camera.y),n||s||o?(p.save(),n&&(p.scale(-1,1),e*=-1,e-=r),s&&(p.scale(1,-1),i*=-1,i-=a),o?(p.translate(e+a,i),p.rotate(u)):p.translate(e,i),p.drawImage(this.tilesheet.canvas,l*r,d*a,r,a,0,0,r,a),p.restore(),this):(p.drawImage(this.tilesheet.canvas,l*r,d*a,r,a,e,i,r,a),this)},s.prototype.draw=function(t,e,i,n,s,o){t._isTileMap&&(t=t.texture.canvas),t._isTexture&&(t=t.canvas);var r=~~Math.round((e||0)-this.camera.x),a=~~Math.round((i||0)-this.camera.y);if(!n&&!s&&!o)return this.ctx.drawImage(t,r,a),this;var h=this.ctx;return h.save(),n&&(h.scale(-1,1),r*=-1,r-=t.width),s&&(h.scale(1,-1),a*=-1,a-=t.height),o?(h.translate(r+t.height,a),h.rotate(u)):h.translate(r,a),h.drawImage(t,0,0),h.restore(),this},s.prototype.clear=function(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this},s.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.locate(0,0),this},s.prototype.pen=function(t){return this._pen=t%this.palette.length,this.ctx.strokeStyle=this.palette[this._pen],this},s.prototype.paper=function(t){return this._paper=t%this.palette.length,this.ctx.fillStyle=this.palette[this._paper],this},s.prototype.rect=function(t,e,i,n){return this.ctx.strokeRect(~~(t-this.camera.x)+.5,~~(e-this.camera.y)+.5,~~(i-1),~~(n-1)),this},s.prototype.rectfill=function(t,e,i,n){return this.ctx.fillRect(~~(t-this.camera.x),~~(e-this.camera.y),~~i,~~n),this},s.prototype.locate=function(t,e){return this._cursor.i=~~t,this._cursor.j=~~e,this},s.prototype.print=function(t,e,i){if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){t="[Object]"}else"string"!=typeof t&&(t=t.toString());if(void 0!==e){e=~~Math.round(e-this.camera.x),i=~~Math.round(i-this.camera.y);for(var n=0;n<t.length;n++)this.ctx.drawImage(this.textCharset.canvas,3*t.charCodeAt(n),5*this._pen,3,5,e,i,3,5),e+=4;return this}for(var n=0;n<t.length;n++){this._cursor.j>=this._textLine&&this.textScroll();var s=t.charCodeAt(n);10!==s&&13!==s?(this.ctx.drawImage(this.textCharset.canvas,3*s,5*this._pen,3,5,4*this._cursor.i,6*this._cursor.j+this._textOffset,3,5),this._cursor.i+=1,this._cursor.i>this._textColumn&&(this._cursor.i=0,this._cursor.j+=1)):(this._cursor.i=0,this._cursor.j+=1)}return this},s.prototype.println=function(t){return this.print(t),this.print("\n"),this},s.prototype.textScroll=function(t){return void 0===t&&(t=1),this._cursor.j-=t,t*=6,this.ctx.drawImage(this.canvas,0,-t),this.ctx.fillRect(0,this.canvas.height-t-this._textPadding,this.canvas.width,t+this._textPadding),this}},{}],2:[function(t,e,i){function n(t,e,i,n,s,o,r,a){this.x=~~t,this.y=~~e,this.sprite=~~i,this.flipH=!!n,this.flipV=!!s,this.flipR=!!o,this.flagA=!!r,this.flagB=!!a}function s(t,e){this._name="",this.width=0,this.height=0,this.items=[],this.texture=new o(t*r,e*a),this.tilesheet=null,this._tilesheetPath="",t&&e&&this._init(t,e)}var o=t("../Texture"),r=settings.tileSize[0],a=settings.tileSize[1];n.prototype.draw=function(t){t.sprite(this.sprite,this.x*r,this.y*a,this.flipH,this.flipV,this.flipR)},e.exports=s,s.prototype._isTileMap=!0;var h={},u=[];s.getMap=function(t){return"string"==typeof t?h[t]:"number"==typeof t?u[t]:(console.error("Map does not exist",t),null)},s._checkBankFormat=function(t){return t?Array.isArray(t)?{_type:"maps",maps:t}:"maps"!==t._type?(console.warn("Map bank format incorrect"),{_type:"maps",maps:[]}):t:(console.warn("No map bank"),{_type:"maps",maps:[]})},s.loadBank=function(t){t=s._checkBankFormat(t);for(var e=[],i=t.maps||[],n=0;n<i.length;n++)e.push((new s).load(i[n]))},Object.defineProperty(s.prototype,"name",{get:function(){return this._name},set:function(t){this._name&&h[this._name]&&h[this._name]===this&&delete h[this._name],this._name=t,t&&!h[t]&&(h[t]=this)}}),s.prototype._init=function(t,e){this.texture.resize(t*r,e*a),this.width=t,this.height=e,this.items=[];for(var i=0;i<t;i++){this.items.push([]);for(var n=0;n<e;n++)this.items[i][n]=null}},s.prototype.resize=function(t,e){var i=this.items,n=Math.min(this.width,t),s=Math.min(this.height,e);this.texture.resize(t*r,e*a),this._init(t,e);for(var o=0;o<n;o++)for(var h=0;h<s;h++)this.items[o][h]=i[o][h];return this.redraw(),this},s.prototype.set=function(t,e,i,s,o,h,u,l){if(null===i||void 0===i)return this.remove(t,e);if(!(t<0||e<0||t>=this.width||e>=this.height)){var d=this.items[t][e]=new n(t,e,i,s,o,h,u,l);return this.texture.ctx.clearRect(t*r,e*a,r,a),d.draw(this.texture),this}},s.prototype.remove=function(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.items[t][e]=null,this.texture.ctx.clearRect(t*r,e*a,r,a),this},s.prototype.get=function(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.items[t][e]},s.prototype.redraw=function(){this.texture.clear();for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.items[t][e]&&this.items[t][e].draw(this.texture);return this},s.prototype.draw=function(t,e){draw(this.texture,t,e)},s.prototype.setTilesheet=function(t){return this.tilesheet=t,this._tilesheetPath=t&&t.path||"",this.texture.setTilesheet(t),this.redraw(),this},s.prototype._setTilesheetPath=function(t){if(this._tilesheetPath=t||"",!t)return this.setTilesheet();t=t.split("/"),fileId=t.pop();for(var e=assets,i=0;i<t.length;i++)if(e=e[t[i]],!e)return console.warn("Could not find tilesheet",t);var n=e[fileId];n&&n instanceof Image&&this.setTilesheet(n)};var l,d;!function(){function t(t){var i=~~(t/s),n=t%s;return e[i]+e[n]}for(var e="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",i={},n=0;n<e.length;n++)i[e[n]]=n;var s=e.length,o=s*s-1,r=Math.pow(2,13),a=o-r-1;l=function(e){str="",count=0;for(var i=0;i<e.length;i++){var n=e[i];n===e[i+1]&&++count<a||(null===n&&(n=o),str+=t(n),count===a&&count--,0!==count&&(str+=t(r+count)),count=0)}return count===a&&count--,0!==count&&(str+=t(r+count)),str},d=function(t){arr=[];for(var e=0;e<t.length;){var n=t[e++],a=t[e++],h=i[n]*s+i[a];if(h===o)arr.push(null);else if(h>r)for(var u=h-r,l=arr[arr.length-1],d=0;d<u;d++)arr.push(l);else arr.push(h)}return arr}}(),s.prototype.save=function(){for(var t=this.width,e=this.height,i=new Array(t*e),n=0;n<t;n++)for(var s=0;s<e;s++){var o=this.items[n][s];i[n+s*t]=o?o.sprite+(o.flipH<<8)+(o.flipV<<9)+(o.flipR<<10)+(o.flagA<<11)+(o.flagB<<12):null}var r={w:t,h:e,name:this.name,sheet:this._tilesheetPath||"",data:l(i)};return r},s.prototype.load=function(t){var e=t.w,i=t.h;this._init(e,i),this.name=t.name||"",this._setTilesheetPath(t.sheet);for(var n=d(t.data),s=0;s<e;s++)for(var o=0;o<i;o++){var r=n[s+o*e];if(null!==r){var a=255&r,h=r>>8&1,u=r>>9&1,l=r>>10&1,p=r>>11&1,c=r>>12&1;this.set(s,o,a,h,u,l,p,c)}}return this.redraw(),this},s.prototype.copy=function(t,e,i,n){t=t||0,e=e||0,void 0!==i&&null!==i||(i=this.width),void 0!==n&&null!==n||(n=this.height);var o=new s(i,n);return o.paste(this,-t,-e),o},s.prototype.paste=function(t,e,i,n){e=e||0,i=i||0;for(var s=Math.min(t.width,this.width-e),o=Math.min(t.height,this.height-i),r=Math.max(0,-e),a=Math.max(0,-i),h=r;h<s;h++)for(var u=a;u<o;u++){var l=t.items[h][u];if(l)this.set(h+e,u+i,l.sprite,l.flipH,l.flipV,l.flipR,l.flagA,l.flagB);else{if(n)continue;this.remove(h+e,u+i)}}return this.redraw(),this},s.prototype.clear=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.items[t][e]=null;return this.texture.clear(),this},s.prototype.find=function(t,e,i){if(null===t)return this._findNull();void 0===e&&(e=null),void 0===i&&(i=null);for(var n=[],s=0;s<this.width;s++)for(var o=0;o<this.height;o++){var r=this.items[s][o];if(r){var a=null===e||r.flagA===e,h=null===i||r.flagB===i;r.sprite===t&&a&&h&&n.push(r)}}return n},s.prototype._findNull=function(){for(var t=[],e=0;e<this.width;e++)for(var i=0;i<this.height;i++)null===this.items[e][i]&&t.push({x:e,y:i});return t}},{"../Texture":1}],3:[function(t,e,i){function n(t,e,i){var n=new XMLHttpRequest;n.responseType=e||"arraybuffer",n.onreadystatechange=function(){if(4===~~n.readyState)return 200!==~~n.status&&0!==~~n.status?i&&i("xhrError:"+n.status):i&&i(null,n.response)},n.open("GET",t,!0),n.send()}function s(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===~~i.readyState)return 200!==~~i.status?e("xhrError:"+i.status):e&&e(null,JSON.parse(i.response))},i.open("GET",t,!0),i.send()}function o(t,e){var i=new XMLHttpRequest;i.open("POST","req",!0),i.setRequestHeader("Content-Type","application/json; charset=UTF-8"),i.onreadystatechange=function(){if(4===~~i.readyState){if(200!==~~i.status)return e&&e("xhr:"+i.status);var t=JSON.parse(i.response);return e&&e(t.error,t.result)}},i.send(JSON.stringify(t))}function r(t,e){var i=new Image;i.onload=function(){this.onload=null,this.onerror=null,e&&e(null,this)},i.onerror=function(){this.onload=null,this.onerror=null,e&&e("img:"+t)},i.src=t}function a(t,e){function i(){e&&e(null,s),s.removeEventListener("canplaythrough",i),s.removeEventListener("error",n)}function n(){e&&e("snd:load"),s.removeEventListener("canplaythrough",i),s.removeEventListener("error",n)}var s=new Audio;s.preload=!0,s.loop=!1,s.addEventListener("canplaythrough",i),s.addEventListener("error",n),s.src=t,s.load()}function h(t,e){s("build/data.json",function(i,n){function s(t,e){var i=t.split("/"),n=i.pop(),s=n.split(".");s.pop(),s=s.join(".");for(var o=h,r=0,a=i.length;r<a;r++)o=o[i[r]];o[s]=e,i.push(s),e.name=s,e.path=i.join("/")}function o(){var i=p+c,f=i/l;e&&e(p,i,l,f);var y,g;i<u?(y=n.img[i],g=r):(y=n.snd[i-u],g=a),c+=1,g(d+y,function(e,i){e||s(y,i),p+=1,c-=1,p+c<l?o():0===c&&t(null,h)})}if(i)return t(i);var h=n.dat,u=n.img.length,l=u+n.snd.length,d=n.root,p=0,c=0;if(0===l)return t(null,h);for(var f=Math.min(5,l-1),y=0;y<=f;y++)o()})}i.loadData=n,i.loadJson=s,i.sendRequest=o,i.loadImage=r,i.loadSound=a,i.preloadStaticAssets=h},{}],4:[function(t,e,i){function n(t){this.id=t,this.volume=1,this.muted=!0,this.loopSound=null,this.loopId=null,this.loopVol=0,this.nextLoop=null}e.exports=n,n.prototype.setVolume=function(t,e){var i=this.muted;this.muted=0===t||e||!1,void 0!==t&&null!==t?this.volume=t:t=this.volume,this.loopId&&(this.loopSound&&this.muted?this.loopSound.stop():this.loopSound&&this.loopSound.id===this.loopId?(this.loopSound.setVolume(Math.max(0,Math.min(1,t*this.loopVol))),i&&this.loopSound.play()):this.muted||this.audioManager.playLoopSound(this.id,this.loopId,this.loopVol))},n.prototype.setMute=function(t){this.setVolume(null,t)},n.prototype.playLoopSound=function(t,e,i,n,s,o){function r(t,e){return t?void(t.stopping||t.stop(function(){return u.freeSound(t),t=null,e&&e()})):e&&e()}function a(){var t=f.loopSound=f.nextLoop;f.nextLoop=null,t&&(t.setLoop(!0,s,o),t.fade=l,t.load(function(s){return s?(t.unload(),void(f.loopSound=null)):void t.play(e*f.volume,i,n)}))}function h(){f.loopSound=null,window.setTimeout(a,0)}var u=this.audioManager,l=u.settings.defaultFade,d=u.settings.crossFading,p=this.loopSound,c=p&&p.id;if(e=Math.max(0,Math.min(1,e||1)),this.loopId=t,this.loopVol=e,!u.muted&&!this.muted){if(t===c&&p)return p.play(e*this.volume,i,n),void(this.nextLoop&&(this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=null));if(p=null,!this.nextLoop||this.nextLoop.id!==t){var f=this;d?(this.nextLoop&&this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=u.createSound(t,this.id),this.nextLoop.load(function(t){return t?(f.nextLoop.unload(),void(f.nextLoop=null)):(r(f.loopSound),void h())})):(this.nextLoop=u.createSound(t,this.id),r(this.loopSound,h))}}}},{}],5:[function(t,e,i){function n(t){this.soundsById={},this.soundGroupsById={},this.permanentSounds={},this.freeSoundPool=[],this.soundArchive=new o(function(){return 1}),this.soundGroupArchive=new o(function(){return 1}),this.soundArchiveById={},this.soundGroupArchiveById={},this.usedMemory=0,this.channels={},this.audioContext=null,this.muted=!1,this.settings={audioPath:"",maxSoundGroup:500,maxUsedMemory:300,defaultFade:2,maxPlayLatency:1e3,crossFading:!1,getFileUri:function(t,e){return t+e+".mp3"},getSoundConstructor:function(t,e){return null}};for(var e=0;e<t.length;e++){var i=t[e];this.channels[i]=new h(i)}u.prototype.audioManager=this,a.prototype.audioManager=this,h.prototype.audioManager=this}var s=window.AudioContext||window.webkitAudioContext,o=t("./OrderedList"),r=t("./SoundBuffered.js"),a=t("./SoundGroup.js"),h=t("./AudioChannel.js"),u=t("./ISound.js");s||(console.warn("Web Audio API is not supported on this platform. Fallback to regular HTML5 <Audio>"),r=t("./Sound.js"),window.Audio||(console.warn("HTML5 <Audio> is not supported on this platform. Sound features are unavailable."),r=u)),e.exports=n,e.exports.ISound=u,n.prototype.init=function(){if(!this.audioContext&&s){this.audioContext=new s,r.prototype.audioContext=this.audioContext;for(var t in this.soundsById)this.soundsById[t].init()}},n.prototype.getEmptySound=function(t,e){var i,n=this.settings.getSoundConstructor(t,e);return n?i=new n:(this.freeSoundPool.length>0?(i=this.freeSoundPool.pop(),i.init()):i=new r,i)},n.prototype.setup=function(t){for(var e in t){var i=t[e];this.setVolume(e,i.volume,i.muted)}},n.prototype.addChannel=function(t){this.channels[t]||(this.channels[t]=new h(t))},n.prototype.setVolume=function(t,e,i){var n=this.channels[t];n&&n.setVolume(e,i)},n.prototype.setMute=function(t){void 0===t&&(t=!this.muted),this.muted=!!t;for(var e in this.channels){var i=this.channels[e];if(i.loopSound)if(t)i.loopSound.stop();else{var n=i.muted;i.muted=!0,i.setVolume(null,n)}}},n.prototype.loadSound=function(t,e){var i=this.createSound(t);return i.load(e),i},n.prototype.createSound=function(t,e){var i=this.getSound(t);return i?i:(i=this.soundsById[t]=this.getEmptySound(e,t),i.setId(t),i)},n.prototype.createSoundPermanent=function(t,e){var i=this.getSound(t);if(i)return i;var n=this.settings.getSoundConstructor(e,t)||r;return i=this.permanentSounds[t]=new n,i.setId(t),i},n.prototype.getSound=function(t){var e=this.permanentSounds[t];return e?e:(e=this.soundsById[t])?e:(e=this.soundArchiveById[t])?(this.soundArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundArchiveById[t],this.soundsById[t]=e,e):null},n.prototype.getSoundGroup=function(t){var e=this.soundGroupsById[t];return e?e:(e=this.soundGroupArchiveById[t])?(this.soundGroupArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundGroupArchiveById[t],e.verifySounds(),this.soundGroupsById[t]=e,e):null},n.prototype.freeSound=function(t){var e=t.id;this.soundsById[e]&&delete this.soundsById[e],this.soundArchiveById[e]&&(this.soundArchive.removeByRef(t.poolRef),t.poolRef=null,delete this.soundArchiveById[e]),t.unload(),t instanceof r&&this.freeSoundPool.push(t)},n.prototype.playLoopSound=function(t,e,i,n,s,o,r){var a=this.channels[t];return a?void a.playLoopSound(e,i,n,s,o,r):console.warn('Channel id "'+t+'" does not exist.')},n.prototype.stopLoopSound=function(t){var e=this,i=this.channels[t];if(!i)return console.warn('Channel id "'+t+'" does not exist.');var n=i.loopSound;i.loopId=null,n&&n.stop(function(){e.freeSound(n),i.loopSound=null})},n.prototype.stopAllLoopSounds=function(){for(var t in this.channels)this.stopLoopSound(t)},n.prototype.release=function(){var t,e,i,n=this.settings.maxSoundGroup,s=this.settings.maxUsedMemory,o={};for(t in this.channels){var r=this.channels[t];r.loopSound&&(o[r.loopSound.id]=!0)}for(t in this.soundGroupsById)e=this.soundGroupsById[t],e.poolRef=this.soundGroupArchive.add(e),this.soundGroupArchiveById[t]=e,delete this.soundGroupsById[t];for(t in this.soundsById)o[t]||(i=this.soundsById[t],i.poolRef=this.soundArchive.add(i),this.soundArchiveById[t]=i,delete this.soundsById[t]);for(var a=this.soundGroupArchive.getCount();a>n&&(e=this.soundGroupArchive.popFirst());)e.poolRef=null,delete this.soundGroupArchiveById[e.id],a-=1;for(;this.usedMemory>s&&(i=this.soundArchive.popFirst());)i.poolRef=null,delete this.soundArchiveById[i.id],this.freeSound(i)},n.prototype.playSound=function(t,e,i,n,s){if(!this.muted){var o=this.channels[t];if(!o.muted){var r=this.getSound(e);r||(r=this.createSound(e,t)),i=i||1,r.play(o.volume*i,n,s)}}},n.prototype.playSoundGroup=function(t,e,i,n,s){if(!this.muted){var o=this.channels[t];if(o&&!o.muted){var r=this.getSoundGroup(e);if(!r)return console.warn('SoundGroup "'+e+'" does not exist.');i=i||1,r.play(i*o.volume,n,s)}}},n.prototype.createSoundGroup=function(t,e,i){if(!this.getSoundGroup(t)){var n=new a(t,e.id,e.vol,e.pitch,i);this.soundGroupsById[t]=n}},n.prototype.createSoundGroups=function(t,e){var i=void 0!==e&&this.channels[e].muted;for(var n in t)this.createSoundGroup(n,t[n],i)}},{"./AudioChannel.js":4,"./ISound.js":6,"./OrderedList":7,"./Sound.js":8,"./SoundBuffered.js":9,"./SoundGroup.js":10}],6:[function(t,e,i){function n(){this.playing=!1,this.stopping=!1,this.fade=0,this.usedMemory=0,this.poolRef=null,this.id=null,this.volume=1,this.pan=0,this.loop=!1,this.pitch=0,this._loaded=!1,this._loading=!1,this._unloading=!1,this._playTriggered=0,this._onLoadQueuedCallback=[]}e.exports=n,n.prototype.setId=function(t){this.id=t,this._loaded=!1},n.prototype.load=function(t){return this.id?this._loaded?t&&t(null,this):(t&&this._onLoadQueuedCallback.push(t),this._loading?void 0:(this._loading=!0,this._load())):t&&t("noId")},n.prototype._finalizeLoad=function(t){var e=this.audioManager.settings.maxPlayLatency;this._loaded=!t,this._loading=!1;for(var i=0;i<this._onLoadQueuedCallback.length;i++)this._onLoadQueuedCallback[i](t,this);return this._onLoadQueuedCallback=[],this._unloading?(this._unloading=!1,void this.unload()):void(this._loaded&&this._playTriggered&&((this.loop||Date.now()-this._playTriggered<e)&&this._play(),this._playTriggered=0))},n.prototype.cancelOnLoadCallbacks=function(){this._onLoadQueuedCallback=[]},n.prototype.play=function(t,e,i){return void 0!==t&&null!==t&&this.setVolume(t),void 0!==e&&null!==e&&this.setPan(e),this._loaded?this.loop&&this.playing?void this._updatePlayPitch(i):void this._play(i):(this._playTriggered=Date.now(),void this.load())},n.prototype.init=function(){},n.prototype.setVolume=function(t){this.volume=t},n.prototype.setPan=function(t){this.pan=t},n.prototype.setLoop=function(t){this.loop=t},n.prototype.setPitch=function(t){this.pitch=t},n.prototype._updatePlayPitch=function(t){},n.prototype._play=function(t){this.playing=!0,console.log('ISound play call: "'+this.id+'"')},n.prototype.stop=function(t){return this.playing=!1,t&&t()},n.prototype._load=function(){return console.log("ISound load call: "+this.id),this._finalizeLoad(null)},n.prototype.unload=function(){return this._playTriggered=0,this.setLoop(!1),this.fade=0,this.pitch=0,this.stop(),this._loading?(this._unloading=!0,!1):(this.audioManager.usedMemory-=this.usedMemory,this.setVolume(1),this.setPan(0),this.id=null,this._loaded=!1,this.usedMemory=0,!0)}},{}],7:[function(t,e,i){function n(t,e,i,n){this.object=t,this.previous=e,this.next=i,this.container=n}function s(t){this.count=0,this.first=null,this.last=null,this.cmpFunc=t}s.prototype.add=function(t){var e=new n(t,null,null,this);if(this.count+=1,null===this.first)return this.first=e,this.last=e,e;var i=this.cmpFunc(t,this.first.object);if(i<0)return e.next=this.first,this.first.previous=e,this.first=e,e;var s=this.cmpFunc(t,this.last.object);if(s>=0)return e.previous=this.last,this.last.next=e,this.last=e,e;var o;if(i+s<0){for(o=this.first.next;this.cmpFunc(t,o.object)>=0;)o=o.next;e.next=o,e.previous=o.previous,e.previous.next=e,o.previous=e}else{for(o=this.last.previous;this.cmpFunc(t,o.object)<0;)o=o.previous;e.previous=o,e.next=o.next,e.next.previous=e,o.next=e}return e},s.prototype.removeByRef=function(t){return!(!t||t.container!==this)&&(this.count-=1,null===t.previous?this.first=t.next:t.previous.next=t.next,null===t.next?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=null,t.container=null,!0)},s.prototype.moveToTheBeginning=function(t){return!(!t||t.container!==this)&&(null===t.previous||(t.previous.next=t.next,this.last===t?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=this.first,t.next.previous=t,this.first=t,!0))},s.prototype.moveToTheEnd=function(t){return!(!t||t.container!==this)&&(null===t.next||(t.next.previous=t.previous,this.first===t?this.first=t.next:t.previous.next=t.next,t.next=null,t.previous=this.last,t.previous.next=t,this.last=t,!0))},s.prototype.possess=function(t){return t&&t.container===this},s.prototype.popFirst=function(){var t=this.first;if(!t)return null;this.count-=1;var e=t.object;return this.first=t.next,null!==this.first&&(this.first.previous=null),t.next=null,t.container=null,e},s.prototype.popLast=function(){var t=this.last;if(!t)return null;this.count-=1;var e=t.object;return this.last=t.previous,null!==this.last&&(this.last.next=null),t.previous=null,t.container=null,e},s.prototype.getFirst=function(){return this.first&&this.first.object},s.prototype.getLast=function(){return this.last&&this.last.object},s.prototype.clear=function(){for(var t=this.first;t;t=t.next)t.container=null;this.count=0,this.first=null,this.last=null},s.prototype.getCount=function(){return this.count},s.prototype.forEach=function(t,e){for(var i=this.first;i;i=i.next)t(i.object,e)},s.prototype.forEachReverse=function(t,e){for(var i=this.last;i;i=i.previous)t(i.object,e)},s.prototype.reposition=function(t){if(t.container!==this)return this.add(t.object);var e=t.previous,i=t.next,n=t.object;for(null===i?this.last=e:i.previous=e,null===e?this.first=i:e.next=i;null!==e&&this.cmpFunc(n,e.object)<0;)i=e,e=e.previous;for(;null!==i&&this.cmpFunc(n,i.object)>=0;)e=i,i=i.next;return t.next=i,null===i?this.last=t:i.previous=t,t.previous=e,null===e?this.first=t:e.next=t,t},e.exports=s},{}],8:[function(t,e,i){function n(){o.call(this);var t=new Audio;t.loop=!1,t.type="audio/mpeg",this._audio=t,this.audioContext&&(this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.audioContext.destination))}var s=t("util").inherits,o=t("./ISound.js"),r={playAudioWhenScreenIsLocked:!1};s(n,o),e.exports=n,n.prototype.setVolume=function(t){this.volume=this._audio.volume=t},n.prototype.setLoop=function(t){this.loop=this._audio.loop=t},n.prototype._load=function(){function t(t){s._finalizeLoad(t)}function e(){this.removeEventListener("canplaythrough",e),this.removeEventListener("error",i),s.usedMemory=this.duration,s.audioManager.usedMemory+=this.duration,s._finalizeLoad(null)}function i(n){this.removeEventListener("canplaythrough",e),this.removeEventListener("error",i),t(n)}function n(t){s._loading=!0,s._audio.addEventListener("canplaythrough",e),s._audio.addEventListener("error",i),s._audio.src=t,s._audio.load()}var s=this,o=this.audioManager.settings.getFileUri,r=this.audioManager.settings.audioPath;if(o.length>2)o(r,this.id,function(e,i){return e?t(e):void n(i)});else try{var a=o(r,this.id);if(!a)return t("emptyUri");n(a)}catch(e){t(e)}},n.prototype.unload=function(){o.prototype.unload.call(this)&&(this._audio.volume=1,this._audio.src="",this._audio.load())},n.prototype._play=function(t){this._audio.volume=this.volume,this._audio.pause(),this._audio.currentTime=0,this._audio.play(r),this.playing=!0},n.prototype.stop=function(t){return this._audio.pause(),this._audio.currentTime=0,this._playTriggered=0,this.playing=!1,t&&t()}},{"./ISound.js":6,util:49}],9:[function(t,e,i){function n(){o.call(this),this.buffer=null,this.source=null,this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._playPitch=0,this._fadeTimeout=null,this._onStopCallback=null,this._audioNodeReady=!1,this._loopStart=0,this._loopEnd=0,this.init()}var s=t("util").inherits,o=t("./ISound.js"),r=1e-6;s(n,o),e.exports=n,n.prototype._createAudioNodes=function(){if(!this._audioNodeReady&&this.audioContext){var t,e=this.audioContext,i=e.createGain();t=e.createStereoPanner?e.createStereoPanner():e.createPanner(),i.connect(t),t.connect(e.destination),i.gain.value=0,this.sourceConnector=i,this.gain=i.gain,this.panNode=t,this._audioNodeReady=!0}},n.prototype._destroyAudioNodes=function(){if(this._audioNodeReady){var t=this.audioContext,e=this.panNode,i=this.sourceConnector;i.disconnect(e),e.disconnect(t.destination),this.source&&(this.source.disconnect(i),this.source.onended=null,this.source=null),this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._audioNodeReady=!1}},n.prototype.init=function(){function t(t){i.buffer=t,i.usedMemory=t.duration,i.audioManager.usedMemory+=t.duration,i.rawAudioData=null,i._loaded&&i._playTriggered&&((i.loop||Date.now()-i._playTriggered<n)&&i._play(),i._playTriggered=0)}function e(){console.error("decode audio failed for sound ",i.id)}if(this._createAudioNodes(),this.rawAudioData){var i=this,n=this.audioManager.settings.maxPlayLatency,s=this.audioContext;s.decodeAudioData(this.rawAudioData,t,e)}},n.prototype.setVolume=function(t){if(this.volume=t,this.playing){if(!this.fade)return void(this.gain.value=t);t<=0&&(t=r);var e=this.audioContext.currentTime;this.gain.cancelScheduledValues(e),this.gain.setValueAtTime(this.gain.value||r,e),this.gain.linearRampToValueAtTime(t,e+this.fade)}},n.prototype.setPan=function(t){this.pan=t,this.panNode&&(this.panNode.pan?this.panNode.pan.value=t:this.panNode.setPosition(t,0,.2))},n.prototype.setLoop=function(t,e,i){this.loop=!!t,this._loopStart=e||0,this._loopEnd=i||0,this.source&&this.buffer&&(this.source.loop=t,this._setLoopPoints())},n.prototype._setLoopPoints=function(){this.source.loopStart=this._loopStart||0;var t=this._loopEnd;t<0&&(t=this.buffer.duration+t),t<0&&(t=0),this.source.loopEnd=t||this.buffer.duration},n.prototype.setPitch=function(t,e){this.pitch=t,this._setPlaybackRate(e)},n.prototype._updatePlayPitch=function(t){!t&&0!==t||t===this._playPitch||(this._playPitch=t,this._setPlaybackRate(0))},n.prototype._setPlaybackRate=function(t){if(this.source){var e=Math.pow(2,(this._playPitch+this.pitch)/12);if(!t)return void(this.source.playbackRate.value=e);var i=this.audioContext.currentTime;this.source.playbackRate.cancelScheduledValues(i),this.source.playbackRate.setValueAtTime(this.source.playbackRate.value||r,i),this.source.playbackRate.linearRampToValueAtTime(e,i+t)}},n.prototype._load=function(){function t(t){n._finalizeLoad(t)}function e(t){n.buffer=t,n.usedMemory=t.duration,n.audioManager.usedMemory+=t.duration,n._finalizeLoad(null)}function i(i){var s=new XMLHttpRequest;s.responseType="arraybuffer",s.onreadystatechange=function(){if(4===~~s.readyState)return 200!==~~s.status&&0!==~~s.status?t("xhrError:"+s.status):void(n.audioContext?n.audioContext.decodeAudioData(s.response,e,t):(n.rawAudioData=s.response,n._finalizeLoad(null)))},s.open("GET",i,!0),s.send()}var n=this;this._createAudioNodes();var s=this.audioManager.settings.getFileUri,o=this.audioManager.settings.audioPath;if(s.length>2)s(o,this.id,function(e,n){return e?t(e):void i(n)});else try{var r=s(o,this.id);if(!r)return t("emptyUri");i(r)}catch(e){t(e)}},n.prototype.unload=function(){o.prototype.unload.call(this)&&(this._fadeTimeout&&(this._onStopCallback=null,this._stopAndClear()),this.buffer=null,this.source&&(this.source.onended=null,this.source.stop(0),this.source=null),this._destroyAudioNodes())},n.prototype._play=function(t){if(!this.buffer)return void(this._playTriggered=Date.now());this.playing=!0;var e=this.audioContext.currentTime;if(this.gain.cancelScheduledValues(e),this.fade?(this.gain.setValueAtTime(this.gain.value||r,e),this.gain.linearRampToValueAtTime(this.volume||r,e+this.fade)):this.gain.value=this.volume,this._fadeTimeout)return this._onStopCallback=null,this.source.onended=null,this.stopping=!1,window.clearTimeout(this._fadeTimeout),void(this._fadeTimeout=null);this.source&&(this.source.disconnect(this.sourceConnector),this.source.onended=null);var i=this.source=this.audioContext.createBufferSource();i.connect(this.sourceConnector);var n=this;i.onended=function(){n.playing=!1,i.onended=null,n.source=null},this._playPitch=t||0,(t||this.pitch)&&this._setPlaybackRate(0),i.loop=this.loop,i.buffer=this.buffer,this._setLoopPoints(),i.start(0)},n.prototype._stopAndClear=function(){this.stopping=!1,this.source.onended=null,this.source.stop(0),this.source=null,this._fadeTimeout&&(window.clearTimeout(this._fadeTimeout),this._fadeTimeout=null),this._onStopCallback&&(this._onStopCallback(),this._onStopCallback=null)},n.prototype.stop=function(t){if(!this.playing&&!this.stopping)return t&&t();if(this._playTriggered=0,this.stopping=!0,this.playing=!1,!this.source)return t&&t();if(this._onStopCallback=t,!this._fadeTimeout){if(this.fade){var e=this,i=this.audioContext.currentTime;return this.gain.cancelScheduledValues(i),this.gain.setValueAtTime(this.gain.value||r,i),this.gain.linearRampToValueAtTime(r,i+this.fade),void(this._fadeTimeout=window.setTimeout(function(){e._fadeTimeout=null,e._stopAndClear()},1e3*this.fade))}this._stopAndClear()}}},{"./ISound.js":6,util:49}],10:[function(t,e,i){function n(t,e,i,n,s){this.id=t,this.soundIds=e,this.volumes=i||[],this.pitches=n||[],this.soundIndex=0,this.volIndex=0,this.pitchIndex=0,this.poolRef=null,this._ready=!1,0===this.volumes.length&&this.volumes.push(1),0===this.pitches.length&&this.pitches.push(0),s||this._createSounds()}e.exports=n,n.prototype._createSounds=function(){
for(var t=this.soundIds,e=0;e<t.length;e++)this.audioManager.loadSound(t[e]);this._ready=!0},n.prototype.play=function(t,e,i){if(0!==this.soundIds.length){this._ready||this._createSounds();var n=this.soundIds[this.soundIndex++],s=this.audioManager.getSound(n);if(!s)return console.warn("[Sound Group: "+this.id+"] sound id "+n+"  cannot be played.");t=t||1,i=i||0,t*=this.volumes[this.volIndex++],i+=this.pitches[this.pitchIndex++],s.play(t,e,i),this.soundIndex>=this.soundIds.length&&(this.soundIndex=0),this.volIndex>=this.volumes.length&&(this.volIndex=0),this.pitchIndex>=this.pitches.length&&(this.pitchIndex=0)}},n.prototype.verifySounds=function(){for(var t=0;t<this.soundIds.length;t++){var e=this.soundIds[t];this.audioManager.createSound(e)}}},{}],11:[function(t,e,i){e.exports={name:"MonkeyWarp",screen:{width:160,height:144,pixelSize:[4,4],fullscreen:!1},tileSize:[8,8],palette:["#183725","#416E2B","#9FBB32","#CFE581"],loaderColors:[3,2],controls:{up:87,down:83,left:65,right:68,start:13,A:75,B:76},touchEvent:{multiTouch:!1,disableContextMenu:!1,hideMousePointer:!1},components:{pixelboxCore:!0,keyboard:!0,TINA:!1,AudioManager:!0}}},{}],12:[function(t,e,i){function n(t,e){return t.x<e.x+e.w&&t.y<e.y+e.h&&e.x<t.x+t.w&&e.y<t.y+t.h}e.exports=n},{}],13:[function(t,e,i){function n(t){this.x=0,this.y=0,this.w=2,this.h=2,this.owner=t,this.reset()}var s=t("./level"),o=t("./view/gameView"),r=t("./AABBcollision"),a=assets.entity.banana,h=settings.tileSize[0],u=settings.tileSize[1],l=.9,d=.01,p=.8,c=20,f=3,y=.433,g=1.369;e.exports=n,n.prototype.reset=function(){audioManager.stopLoopSound("banana"),this.sx=0,this.sy=0,this.grabbing=null,this.flying=!1,this.throwing=!1,this.throwCounter=0,this.frame=0},n.prototype.draw=function(){var t=a.idle;this.flying&&(this.frame+=.2,this.frame>=4&&(this.frame=0),t=a["fly"+~~this.frame]),draw(t,this.x-4,this.y-4)},n.prototype.maxSpeed=function(){this.sx>f&&(this.sx=f),this.sx<-f&&(this.sx=-f),this.sy>f&&(this.sy=f),this.sy<-f&&(this.sy=-f)},n.prototype.update=function(){this.throwing?(this.throwCounter++>c&&(this.throwing=!1),this.levelCollisions()):this.flying?(this.sx+=clip((this.owner.x-this.x)*d,-p,p),this.sy+=clip((this.owner.y-this.y)*d,-p,p),this.sx*=l,this.sy*=l,this.maxSpeed(),this.levelCollisions(),r(this,this.owner)&&this._catchBanana()):(this.x=this.owner.x+3,this.y=this.owner.y-5),this.grabbing&&(this.grabbing.x=this.x-2,this.grabbing.y=this.y-6)},n.prototype.levelCollisions=function(){var t=this.x+this.sx,e=this.y+this.sy,i=s.width*h;this.sx<0&&t<0&&(t=0,this.sx*=-1),this.sx>0&&t>i&&(t=i,this.sx*=-1),s.getTileAt(t,this.y).fruitSolid&&(this.sx*=-1,t=this.x),s.getTileAt(this.x,e).fruitSolid&&(this.sy*=-1,e=this.y),this.x=t,this.y=e},n.prototype.getTeleportPosition=function(){if(s.getTileAt(this.x,this.y).isSolid)return null;var t=this.x-3,e=this.y-3,i=this.owner,n=i.w,o=i.h;if(s.getTileAt(t,e).isTeleportable&&s.getTileAt(t+n,e).isTeleportable&&s.getTileAt(t,e+o).isTeleportable&&s.getTileAt(t+n,e+o).isTeleportable)return{x:t,y:e};var r=~~(t/h)*h,a=~~(e/u)*u;return s.getTileAt(r,a).isTeleportable?{x:r,y:a}:s.getTileAt(r+h,a).isTeleportable?{x:r+h,y:a}:s.getTileAt(r,a+u).isTeleportable?{x:r,y:a+u}:s.getTileAt(r+h,a+u).isTeleportable?{x:r+h,y:a+u}:void 0},n.prototype.fire=function(t,e){s.getTileAt(this.x,this.y).fruitSolid||(audioManager.playLoopSound("banana","banana fly",1,0,0,y,g),this.flying=!0,this.throwing=!0,this.throwCounter=0,this.sx=t,this.sy=e,this.maxSpeed())},n.prototype.grab=function(t){this.grabbing||(sfx("catch"),this.grabbing=t,o.removeEntityFromCollisions(t))},n.prototype._catchBanana=function(){sfx("catch"),this.flying=!1,audioManager.stopLoopSound("banana"),this.grabbing&&(this.grabbing.collectItem(this.owner),this.grabbing=null)}},{"./AABBcollision":12,"./level":30,"./view/gameView":37}],14:[function(t,e,i){function n(t){this.x=0,this.y=0,this.w=c,this.h=f,this.gamepadIndex=t||0,this.banana=new a(this),this.maxLife=4,this.lifePoints=this.maxLife,this.sprite=16*t,this.reset()}var s=t("./viewManager"),o=t("./view/gameView"),r=t("./level"),a=t("./Banana"),h=t("./AABBcollision"),u=t("./tiles"),l=t("./speedrun"),d=assets.entity.monkey,p=assets.entity.arrow,c=settings.tileSize[0],f=settings.tileSize[1],y=.5,g=3,v=1,m=4;e.exports=n,n.prototype.reset=function(){this.sx=0,this.sy=0,this.dx=0,this.dy=0,this.hasKey=!1,this.onTile=u.EMPTY,this.aiming=!1,this.jumping=!1,this.grounded=!1,this.isLocked=!1,this.isHit=!1,this.jumpCounter=0,this.hitCounter=0,this.frame=0,this.flipH=!1,this.banana.reset()},n.prototype.draw=function(){this.aiming&&draw(p[""+this.dx+this.dy],this.x-16,this.y-20);var t=d.idle;this.isHit&&this.isLocked?t=d.hit:this.jumping?t=d.jump:(this.sx>.5||this.sx<-.5)&&(this.frame+=.3,this.frame>=3&&(this.frame=0),t=d["run"+~~this.frame]),draw(t,this.x-1,this.y-1,this.flipH),this.banana.draw()},n.prototype.update=function(t){this._updateControls(t),this.sx*=this.isHit?.99:.8,this.grounded||(this.sy+=y,this.sy=Math.min(this.sy,g)),this.isHit&&(this.hitCounter++,this.hitCounter>16&&(this.lifePoints<=0&&this.death(),this.isLocked=!1),this.hitCounter>50&&(this.isHit=!1)),this.levelCollisions(),this.banana.update()},n.prototype.aim=function(t){this.banana.flying||(this.aiming=!0,this.dx=0,this.dy=0,t.btn.right&&(this.dx+=1,this.flipH=!1),t.btn.left&&(this.dx-=1,this.flipH=!0),t.btn.down&&(this.dy+=1),t.btn.up&&(this.dy-=1),0===this.dx&&0===this.dy&&(this.dx=this.flipH?-1:1))},n.prototype.teleport=function(){if(this.banana.flying){var t=this.banana.getTeleportPosition();t&&(sfx("teleport"),this.banana.x=this.x+4,this.banana.y=this.y+4,this.x=t.x,this.y=t.y,this.grounded=!1)}},n.prototype.startJump=function(){this.grounded&&(sfx("jump"),this.grounded=!1,this.jumping=!0,this.jumpCounter=0)},n.prototype.jump=function(){this.jumping&&(this.jumpCounter++>12&&(this.jumping=!1),this.sy=-3+.08*this.jumpCounter)},n.prototype._updateControls=function(t){if(!this.isLocked){if(t.btnr.B&&!this.banana.flying&&(this.aiming=!1,this.banana.fire(this.dx*m,this.dy*m)),t.btnp.B&&this.banana.flying&&this.teleport(),t.btnp.A&&this.startJump(),t.btnr.A&&(this.jumping=!1),t.btn.A&&this.jump(),t.btn.B)return this.aim(t);t.btn.right&&!t.btn.left&&(this.sx=v,this.flipH=!1),t.btn.left&&!t.btn.right&&(this.sx=-v,this.flipH=!0),t.btnp.up&&!t.btn.right&&!t.btn.left&&this.onTile.interactive&&this.useInteractive();var e=this.onTile=r.getTileAt(this.x+4,this.y+4);return e.kill?this.death():void 0}},n.prototype.levelCollisions=function(){this.sx=~~(100*this.sx)/100,this.sy=~~(100*this.sy)/100;var t=this.x+this.sx,e=this.y+this.sy,i=r.width*c-this.w,n=r.height*f+64;if(t<0&&(t=0),t>i&&(t=i),e>n)return sfx("fall"),void this.death();var s=this.w,o=0;if(this.sx<0&&(s=0,o=this.w),0!==this.sx?(r.getTileAt(t+s,this.y+1).isSolid||r.getTileAt(t+s,this.y+this.h-1).isSolid)&&(this.sx=0,t=~~(t/c)*c+o):t=Math.round(t),this.grounded){var a=r.getTileAt(t+1,e+this.h+1),h=r.getTileAt(t+this.w-2,e+this.h+1);a.isEmpty&&h.isEmpty&&(this.grounded=!1)}else if(this.sy>0){var a=r.getTileAt(t+1,e+this.h),h=r.getTileAt(t+this.w-2,e+this.h);if(a.isSolid||h.isSolid)this._ground(),e=~~(e/f)*f;else if(a.isTopSolid||h.isTopSolid){var u=~~(e/f)*f;this.y<=u&&(this._ground(),e=u)}}else if(this.sy<0){var l=r.getTileAt(t+1,e),d=r.getTileAt(t+this.w-2,e);(l.isSolid||d.isSolid)&&(this.sy=0,e=~~(e/f)*f+this.w)}this.x=t,this.y=e},n.prototype._ground=function(){this.grounded=!0,this.jumping=!1,this.sy=0},n.prototype.checkCollisionWithEntity=function(t){var e=this.banana;t.collisionMonkey&&h(this,t)&&t.collisionMonkey(this),e.flying&&t.collisionBanana&&h(e,t)&&t.collisionBanana(e)},n.prototype.hit=function(t){this.isHit||(sfx("hit"),this.sx=t.x<this.x?1.6:-1.6,this.sy=t.y<this.y?2:-3,this.aiming=!1,this.grounded=!1,this.isLocked=!0,this.isHit=!0,this.hitCounter=0,this.lifePoints-=1,o.shakeCamera(3),o.updateHealthHUD())},n.prototype.death=function(){audioManager.stopLoopSound("banana"),this.lifePoints=this.maxLife,this.isHit=!0,this.isLocked=!0,l.death(),s.open("gameover")},n.prototype.useInteractive=function(){this.onTile.door&&o.gotoNextLevel()}},{"./AABBcollision":12,"./Banana":13,"./level":30,"./speedrun":33,"./tiles":34,"./view/gameView":37,"./viewManager":45}],15:[function(t,e,i){function n(t,e){t=t||{},this.controller=e||s,this.x=0,this.y=0,this.sx=0,this.sy=0,this.frame=0,this.life=0,this.flipH=!1,this.flipV=!1,this.animation=t.animation,this.animSpeed=t.animSpeed||0,this.lifetime=t.lifetime||this.animation.length/this.animSpeed,this.gravity=t.gravity||0,this.controller.addEntity(this)}var s=t("./view/gameView");e.exports=n,n.prototype.draw=function(){if(this.life+=1,this.life>=this.lifetime)return void this.controller.removeEntity(this);this.sy+=this.gravity,this.x+=this.sx,this.y+=this.sy,this.frame+=this.animSpeed,this.frame>=this.animation.length&&(this.frame=0);var t=this.animation[~~this.frame];draw(t,this.x,this.y,this.flipH,this.flipV)}},{"./view/gameView":37}],16:[function(t,e,i){function n(t,e){this.x=0,this.y=0,this.frame=0,this.flipH=!1,this.flipV=!1,this.animSpeed=e||.2,this.animation=t}var s=t("./view/gameView");e.exports=n,n.prototype.draw=function(){if(this.frame+=this.animSpeed,this.frame>=this.animation.length)return void s.removeEntity(this);var t=this.animation[~~this.frame];"number"==typeof t?sprite(t,this.x,this.y,this.flipH,this.flipV):draw(t,this.x,this.y,this.flipH,this.flipV)},n.prototype.setAnimation=function(t,e){return this.animation=t,this.animSpeed=e||this.animSpeed||.2,this},n.prototype.setPosition=function(t,e){return this.x=t,this.y=e,this}},{"./view/gameView":37}],17:[function(t,e,i){function n(t,e,i,n){this.w=t,this.h=e,this.paper=0,this.color=0,this.texture=new s(t,e),this.texture.setTilesheet(i)}var s=t("Texture"),o=settings.tileSize[0],r=(settings.tileSize[1],32);e.exports=n,n.prototype.clear=function(){return this.texture.clear(),this},n.prototype.cls=function(){return this.texture.paper(this.paper),this.texture.cls(),this},n.prototype.addText=function(t,e,i){for(var n=0;n<t.length;n++){var s=t.charCodeAt(n),a=64*this.color+s-r;this.texture.sprite(a,e,i),e+=o}return this},n.prototype.setColor=function(t){return this.color=~~t%4,this}},{Texture:1}],18:[function(t,e,i){i.explosion=[assets.entity.explosion.frame0,assets.entity.explosion.frame1,assets.entity.explosion.frame2,assets.entity.explosion.frame3,assets.entity.explosion.frame4,assets.entity.explosion.frame5,assets.entity.explosion.frame6,assets.entity.explosion.frame7,assets.entity.explosion.frame8],i.getFX=[assets.entity.getFX.frame0,assets.entity.getFX.frame1,assets.entity.getFX.frame2,assets.entity.getFX.frame3,assets.entity.getFX.frame4,assets.entity.getFX.frame5,assets.entity.getFX.frame6]},{}],19:[function(t,e,i){audioManager.loadSound("jump"),audioManager.loadSound("teleport"),audioManager.loadSound("catch"),audioManager.loadSound("wrong"),audioManager.loadSound("explosion"),audioManager.loadSound("fall"),audioManager.loadSound("hit"),audioManager.loadSound("item"),audioManager.loadSound("bounce")},{}],20:[function(t,e,i){function n(t){this.x=0,this.y=0,this.w=8,this.h=8,this.sx=0,this.sy=0,this.sleeping=!0,this.frame=random(f)}var s=t("../view/gameView"),o=t("../ShortAnimation"),r=t("../animations"),a=(t("../level"),t("./ItemLife")),h=(settings.tileSize[0],settings.tileSize[1],.2),u=[assets.entity.bat.fly0,assets.entity.bat.fly1,assets.entity.bat.fly2,assets.entity.bat.fly1],l=.9,d=.01,p=.03,c=.5,f=u.length;e.exports=n,n.prototype.draw=function(){var t=s.monkey;if(this.sleeping)return draw(assets.entity.bat.hang0,this.x,this.y),void(Math.abs(t.x-this.x)<24&&t.y>this.y&&t.y-this.y<64&&(this.sleeping=!1));var e=t.x+4,i=t.y-4;this.sx+=clip((e-this.x)*d,-p,p),this.sy+=clip((i-this.y)*d,-p,p),this.sx*=l,this.sy*=l,this.sx>c&&(this.sx=c),this.sx<-c&&(this.sx=-c),this.sy>c&&(this.sy=c),this.sy<-c&&(this.sy=-c);var n=this.x+this.sx,o=this.y+this.sy;this.x=n,this.y=o,this.frame+=h,this.frame>=f&&(this.frame=0),draw(u[~~this.frame],this.x-7,this.y-3)},n.prototype.collisionBanana=function(t){sfx("explosion"),s.removeEntity(this);var e=new o(r.explosion,.5);if(e.setPosition(this.x-8,this.y-8),s.addEntity(e,!1),Math.random()<.3){var i=new a;i.sy=-1,i.x=~~this.x,i.y=~~this.y,s.addEntity(i,!0)}},n.prototype.collisionMonkey=function(t){t.hit(this)}},{"../ShortAnimation":16,"../animations":18,"../level":30,"../view/gameView":37,"./ItemLife":25}],21:[function(t,e,i){function n(){this.x=0,this.y=0,this.sx=0,this.sy=0,this.frame=0}var s=.2;e.exports=n,n.prototype.draw=function(){this.x+=this.sx,this.y+=this.sy,this.frame+=s,this.frame>=2&&(this.frame=0),sprite(230,this.x,this.y,!1,this.frame>1)}},{}],22:[function(t,e,i){function n(t){t=t||{},this.hx=t.x,this.hy=t.y,this.x=0,this.y=0,this.w=8,this.h=8,this.a=0,this.frame=0}var s=(t("../level"),t("../Particle")),o=(settings.tileSize[0],settings.tileSize[1],.05),r=2*Math.PI,a=32,h=[assets.entity.chainedBall.ball0,assets.entity.chainedBall.ball1],u=[assets.entity.chainedBall.particle0,assets.entity.chainedBall.particle1,assets.entity.chainedBall.particle2],l={animation:u,animSpeed:.2,lifetime:null,gravity:0},d=h.length,p=.5;e.exports=n,n.prototype.draw=function(){this.a+=o,this.a>r&&(this.a-=r);var t=Math.cos(this.a),e=Math.sin(this.a);if(this.x=this.hx+t*a-4,this.y=this.hy+e*a-4,this.frame+=p,this.frame>=d){this.frame=0;var i=new s(l);i.x=this.x,i.y=this.y,i.sx=.2*(Math.random()-.5),i.sy=.2*(Math.random()-.5)}draw(h[~~this.frame],this.x-1,this.y-1)},n.prototype.collisionMonkey=function(t){t.hit(this)}},{"../Particle":15,"../level":30}],23:[function(t,e,i){function n(t){t=t||{},this.x=0,this.y=0,this.w=a,this.h=h,this.ox=t.offsetX||0,this.oy=t.offsetY||0,this.sprites=t.sprites,this.frame=0,this.animated=this.sprites.length>1}var s=t("../view/gameView"),o=t("../ShortAnimation"),r=t("../animations"),a=settings.tileSize[0],h=settings.tileSize[1],u=.2;e.exports=n,n.prototype.draw=function(){this.animated&&(this.frame+=u,this.frame>=this.sprites.length&&(this.frame=0));var t=this.sprites[~~this.frame];draw(t,this.x+this.ox,this.y+this.oy)},n.prototype.collisionBanana=function(t){t.grab(this)},n.prototype.collisionMonkey=function(t){this.collectItem(t)},n.prototype.collectItem=function(t){sfx("item"),s.removeEntity(this);var e=new o(r.getFX,.4);e.setPosition(this.x-12,this.y-12),s.addEntity(e,!1)}},{"../ShortAnimation":16,"../animations":18,"../view/gameView":37}],24:[function(t,e,i){function n(){o.call(this,a)}var s=t("../view/gameView"),o=t("./Item"),r=[assets.entity.item.key0,assets.entity.item.key1,assets.entity.item.key2,assets.entity.item.key4,assets.entity.item.key5,assets.entity.item.key6,assets.entity.item.key7,assets.entity.item.key8,assets.entity.item.key9,assets.entity.item.key10,assets.entity.item.key11,assets.entity.item.key12],a={sprites:r,offsetX:-1,offsetY:-1};inherits(n,o),e.exports=n,n.prototype.collectItem=function(t){o.prototype.collectItem.call(this,t),t.hasKey=!0,s.displayMessage("   YOU FOUND A KEY")}},{"../view/gameView":37,"./Item":23}],25:[function(t,e,i){function n(){o.call(this,u),this.grounded=!1,this.rebound=0,this.sy=0,this.isLocked=!0,this.lockedCounter=30}var s=t("../view/gameView"),o=t("./Item"),r=t("../level"),a=(settings.tileSize[0],settings.tileSize[1]),h=[assets.entity.item.life0,assets.entity.item.life1,assets.entity.item.life2,assets.entity.item.life3,assets.entity.item.life4,assets.entity.item.life5,assets.entity.item.life6,assets.entity.item.life7,assets.entity.item.life8],u={sprites:h,offsetX:-2,offsetY:-3},l=.15,d=2.5,p=.7;inherits(n,o),e.exports=n,n.prototype.draw=function(){if(this.isLocked&&this.lockedCounter--<=0&&(this.isLocked=!1),!this.grounded){this.sy+=l,this.sy=Math.min(this.sy,d);var t=this.y+this.sy;r.getTileAt(this.x+4,t+8).isTopSolid&&(t=this.y,this.sy*=-p,this.rebound+=1,sfx("bounce",Math.min(1,-this.sy)),this.rebound>3&&(this.grounded=!0,t=~~(this.y/a+1)*a)),this.y=t}o.prototype.draw.call(this)},n.prototype.collisionBanana=function(t){this.isLocked||t.grab(this)},n.prototype.collectItem=function(t){o.prototype.collectItem.call(this,t),t.lifePoints<t.maxLife&&(t.lifePoints+=1),s.updateHealthHUD()}},{"../level":30,"../view/gameView":37,"./Item":23}],26:[function(t,e,i){function n(t){this.x=0,this.y=0,this.w=r,this.h=a,this.frame=0,this.directionId=0,this.direction=l[0],this.moveCounter=0,this.freezed=!1,this.freezeCounter=0}function s(t,e,i,n){return t.getTile(e+n.x,i+n.y)}var o=(t("../view/gameView"),t("../level")),r=settings.tileSize[0],a=settings.tileSize[1],h=.2,u=240,l=[{x:1,y:0},{x:0,y:1},{x:-1,y:0},{x:0,y:-1}],d=[assets.entity.spark.frame0,assets.entity.spark.frame1];e.exports=n,n.prototype.draw=function(){return this.freezed?(this.freezeCounter++>=u&&(this.freezed=!1),void draw(d[~~this.frame],this.x-1,this.y-1)):(this.x+=this.direction.x,this.y+=this.direction.y,this.moveCounter+=1,this.moveCounter>=r&&(this.moveCounter=0,this._getNextMove()),this.frame+=h,this.frame>=2&&(this.frame=0),void draw(d[~~this.frame],this.x-1,this.y-1))},n.prototype.collisionBanana=function(t){this.freezed=!0,this.freezeCounter=0},n.prototype.collisionMonkey=function(t){t.hit(this)},n.prototype._getNextMove=function(){var t=~~(this.x/r),e=~~(this.y/a),i=(this.direction,(this.directionId+1)%4),n=l[i];if(s(o,t,e,n).isEmpty)return this.directionId=i,void(this.direction=n);for(;s(o,t,e,this.direction).isSolid;)this.directionId=this.directionId-1,this.directionId<0&&(this.directionId=3),this.direction=l[this.directionId]}},{"../level":30,"../view/gameView":37}],27:[function(t,e,i){function n(t){this.x=0,this.y=0,this.w=8,this.h=8,this.sx=u,this.sy=0,this.frame=random(d)}var s=t("../view/gameView"),o=t("../ShortAnimation"),r=t("../animations"),a=t("../level"),h=t("./ItemLife"),u=(settings.tileSize[0],settings.tileSize[1],.1),l=[assets.entity.worm.walk0,assets.entity.worm.walk1,assets.entity.worm.walk2,assets.entity.worm.walk3,assets.entity.worm.walk2,assets.entity.worm.walk1],d=l.length;e.exports=n,n.prototype.draw=function(){var t=this.x,e=this.y;t+=this.sx,(this.sx>0&&a.getTileAt(t+this.w,this.y).isSolid||this.sx>0&&a.getTileAt(t+this.w,this.y+this.h).isEmpty||this.sx<0&&a.getTileAt(t+4,this.y).isSolid||this.sx<0&&a.getTileAt(t+4,this.y+this.h).isEmpty)&&(t=this.x,this.sx*=-1),this.x=t,this.y=e,this.frame+=u,this.frame>=d&&(this.frame=0),draw(l[~~this.frame],this.x-3,this.y)},n.prototype.collisionBanana=function(t){sfx("explosion"),s.removeEntity(this);var e=new o(r.explosion,.5);if(e.setPosition(this.x-8,this.y-8),s.addEntity(e,!1),Math.random()<.1){var i=new h;i.sy=-2,i.x=~~this.x,i.y=~~this.y,s.addEntity(i,!0)}},n.prototype.collisionMonkey=function(t){t.hit(this)}},{"../ShortAnimation":16,"../animations":18,"../level":30,"../view/gameView":37,"./ItemLife":25}],28:[function(t,e,i){function n(t,e,i,n){e=e||{},e.x=i.x*p,e.y=i.y*c;var o=new t(e);return o.x=e.x,o.y=e.y,s.addEntity(o,n),o}var s=(t("../level"),t("../view/gameView")),o=t("./ItemKey"),r=t("./ItemLife"),a=t("./Butterfly"),h=t("./Worm"),u=t("./Spark"),l=t("./ChainedBall"),d=t("./Bat"),p=settings.tileSize[0],c=settings.tileSize[1];i.createEntityfromMapItem=function(t){switch(t.sprite){case 32:case 33:return n(o,null,t,!0);case 34:return n(r,null,t,!0);case 48:return n(a,null,t,!1);case 64:return n(u,null,t,!0);case 65:return n(h,null,t,!0);case 66:case 67:return n(l,null,t,!0);case 68:return n(d,null,t,!0);default:return null}}},{"../level":30,"../view/gameView":37,"./Bat":20,"./Butterfly":21,"./ChainedBall":22,"./ItemKey":24,"./ItemLife":25,"./Spark":26,"./Worm":27}],29:[function(t,e,i){function n(){this.available=!1,this.btn={},this.btnp={},this.btnr={},this.x=0,this.y=0,this.z=0,this.w=0,this.lt=0,this.rt=0,this._setupButtons()}function s(){for(var t=navigator.getGamepads(),e=0;e<4;e++){var i=t[e],n=h[e];if(i){n.available=!0;for(var s=0;s<r.length;s++){var o=r[s],a=i.buttons[s].pressed;n.btnp[o]=!n.btn[o]&&a,n.btnr[o]=n.btn[o]&&!a,n.btn[o]=a}n.x=i.axes[0],n.y=i.axes[1],n.z=i.axes[2],n.w=i.axes[3],n.lt=i.buttons[6].value,n.rt=i.buttons[7].value}else n.available=!1}return h}function o(){return h}var r=["A","B","X","Y","lb","rb","lt","rt","back","start","lp","rp","up","down","left","right"],a=!(!navigator||!navigator.getGamepads);n.prototype._setupButtons=function(){for(var t=0;t<r.length;t++){var e=r[t];this.btn[e]=!1,this.btnp[e]=!1,this.btnr[e]=!1}};var h=[new n,new n,new n,new n],u=new n;i.getAllGamepads=a?s:o,i.getAnyGamepad=function(){i.getAllGamepads();for(var t=0;t<r.length;t++){var e=r[t];u.btnp[e]=btnp[e]||h[0].btnp[e]||h[1].btnp[e]||h[2].btnp[e]||h[3].btnp[e],u.btnr[e]=btnr[e]||h[0].btnr[e]||h[1].btnr[e]||h[2].btnr[e]||h[3].btnr[e],u.btn[e]=btn[e]||h[0].btn[e]||h[1].btn[e]||h[2].btn[e]||h[3].btn[e]}return u};var l=0;i.setInpuMode=function(t){l=t},i.getGamepad=function(){return l===-1?window:s()[l]}},{}],30:[function(t,e,i){var n=t("TileMap"),s=t("Texture"),o=t("./tiles"),r=t("./entity/entities"),a=settings.tileSize[0],h=settings.tileSize[1],u=i;u.width=20,u.height=18,u.background=null,u.layer=new s(u.width*a,u.height*h),u.geometry=new n(u.width,u.height),i.load=function(t){var e=t+"/";u.geometry=getMap(e+"G"),u.geometry||console.error("Could not find map",e+"G"),u.width=u.geometry.width,u.height=u.geometry.height;var i=u.width*a,n=u.height*h;u.background=getMap(e+"B"),u.layer.resize(i,n),u.layer.clear();for(var s=0,o=getMap(e+"L"+s);o;)u.layer.draw(o),o=getMap(e+"L"+ ++s);for(var l=0;l<u.width;l++)for(var d=0;d<u.height;d++){var p=u.geometry.get(l,d);p&&r.createEntityfromMapItem(p)}return u},i.drawBackground=function(){u.background&&draw(u.background,0,0)},i.draw=function(){draw(u.layer,0,0)},i.getTileAt=function(t,e){return t=~~(t/a),e=~~(e/h),t<0?t=0:t>=u.width&&(t=u.width-1),e<0?e=0:e>=u.height&&(e=u.height-1),o.getTileFromMapItem(u.geometry.get(t,e))},i.getTile=function(t,e){return t<0?t=0:t>=u.width&&(t=u.width-1),e<0?e=0:e>=u.height&&(e=u.height-1),o.getTileFromMapItem(u.geometry.get(t,e))},i.getEntryPoints=function(){var t=u.geometry.find(255),e=u.geometry.find(16),i=u.geometry.find(32),n=u.geometry.find(33),s=!(!i.length&&!n.length);return 1===t.length&&1===e.length||console.log("Level entry points miss configured"),{entry:t[0],exit:e[0],needKey:s}}},{"./entity/entities":28,"./tiles":34,Texture:1,TileMap:2}],31:[function(t,e,i){audioManager.settings.defaultFade=.01,audioManager.addChannel("banana");var n=t("./viewManager");n.addView("splash",t("./view/splashView")),n.addView("title",t("./view/titleView")),n.addView("password",t("./view/passwordView")),n.addView("game",t("./view/gameView")),n.addView("pause",t("./view/pauseView")),n.addView("intermission",t("./view/intermissionView")),n.addView("credit",t("./view/creditView")),n.addView("gameover",t("./view/gameoverView")),n.addView("ending",t("./view/endingView")),n.addView("speedrunResult",t("./view/speedrunResultView")),n.open("splash"),t("./audioPreloading"),i.update=n.update},{"./audioPreloading":19,"./view/creditView":35,"./view/endingView":36,"./view/gameView":37,"./view/gameoverView":38,"./view/intermissionView":39,"./view/passwordView":40,"./view/pauseView":41,"./view/speedrunResultView":42,"./view/splashView":43,"./view/titleView":44,"./viewManager":45}],32:[function(t,e,i){function n(t){if(5!=t.length)return null;for(var e=[],i=0;i<t.length;i++){var n=t[i],s=l[n];if(void 0===s)return null;for(var o=0;o<5;o++){var r=s>>o&1;e.push(!!r)}}return e}function s(t){if(25!==t.length)return null;for(var e="",i=0;i<5;i++){for(var n=0,s=0;s<5;s++){var o=t[5*i+s];o&&(n+=1<<s)}e+=u[n]}return e}function o(){this.matrix=new Array(25),this.grid=new r(5,5).setTilesheet(assets.tilesheet)}var r=t("TileMap"),a=getMap("passGrid"),h=7,u=".D*Rw<4yAp1ilc83-z>q#t02rxBj+CkE",l={};!function(){for(var t=0;t<u.length;t++){var e=u[t];l[e]=t}}(),e.exports=o,o.prototype.setPassword=function(t){var e=n(t);for(x=0;x<5;x++)for(y=0;y<5;y++){var i=e[5*x+y];i?this.grid.set(x,y,h):this.grid.remove(x,y)}},o.prototype.getPassword=function(){return s(this.matrix)},o.prototype.switchBit=function(t,e){this.grid.get(t,e)?(this.grid.remove(t,e),this.matrix[5*t+e]=!1):(this.grid.set(t,e,h),this.matrix[5*t+e]=!0)},o.prototype.draw=function(t,e){draw(a,t,e),draw(this.grid,t+8,e+8)}},{TileMap:2}],33:[function(t,e,i){function n(t){this.data=t,this.frame=0,this.death=0}var s=t("./TextBox"),o=60,r=60*o,a=assets.levels,h={index:-1,level:null,chapter:null};!function(){for(var t={chapter:0,title:""},e=1,i=0;i<assets.levels.length;i++){var n=assets.levels[i];n.intermission?t=assets.levels[i]:(n.chapter=t,n.stage=e++)}}(),n.prototype.getTime=function(){var t=this.frame,e=~~(t/r);t-=e*r;var i=~~(t/o);t-=i*o;var n=~~(100*t/o),s=("0"+e).slice(-2)+":"+("0"+i).slice(-2)+"."+("0"+n).slice(-2);return s};var u,l,d,p=new s(64,8,assets.font.tetris).setColor(0);p.paper=0,e.exports.reset=function(){l=new n(h),u=[];for(var t=0;t<a.length;t++)u.push(new n(a[t]));d=u[0]},e.exports.setLevel=function(t){d=u[t]},e.exports.update=function(){l.frame+=1,d.frame+=1},e.exports.death=function(){l.death+=1,d.death+=1},e.exports.draw=function(){p.cls(),p.addText(l.getTime(),0,0),draw(p.texture,96,0)},e.exports.getResult=function(){return{levels:u,total:l}}},{"./TextBox":17}],34:[function(t,e,i){var n=i.EMPTY={isEmpty:!0,isSolid:!1,isTopSolid:!1,fruitSolid:!1,isTeleportable:!0,kill:!1,interactive:!1},s=i.SOLID={isEmpty:!1,isSolid:!0,isTopSolid:!0,fruitSolid:!0,isTeleportable:!1,kill:!1,interactive:!1},o=i.ONE_WAY={isEmpty:!1,isSolid:!1,isTopSolid:!0,fruitSolid:!1,isTeleportable:!0,kill:!1,interactive:!1},r=i.KILL={isEmpty:!0,isSolid:!1,isTopSolid:!1,fruitSolid:!1,isTeleportable:!1,kill:!0,interactive:!1},a=i.GLASS={isEmpty:!1,isSolid:!0,isTopSolid:!0,fruitSolid:!1,isTeleportable:!1,kill:!1,interactive:!1},h=i.DOOR1={isEmpty:!1,isSolid:!1,isTopSolid:!1,fruitSolid:!1,isTeleportable:!0,kill:!1,interactive:!0,door:1},u=(i.DOOR2={isEmpty:!1,isSolid:!1,isTopSolid:!1,fruitSolid:!1,isTeleportable:!0,kill:!1,interactive:!0,door:2},i.DOOR3={isEmpty:!1,isSolid:!1,isTopSolid:!1,fruitSolid:!1,isTeleportable:!0,kill:!1,interactive:!0,door:3},{0:s,1:o,6:r,7:a,16:h,33:a,67:s});i.getTileFromMapItem=function(t){return t?u[t.sprite]||n:n}},{}],35:[function(t,e,i){var n=t("../gamepad").getAnyGamepad,s=t("../viewManager"),o=t("../TextBox"),r=(settings.screen.height,new o(160,144,assets.font.tetris).setColor(3)),a=0;r.setColor(1).addText("      CREDITS",0,8*a++),a++,a++,r.setColor(3).addText("   CEDRIC STOQUER",0,8*a++),r.setColor(2).addText("   PIXELS, CODING",0,8*a++),a++,r.setColor(3).addText("   MARK SPARLING",0,8*a++),r.setColor(2).addText("       MUSIC",0,8*a++),a++,r.setColor(3).addText("   SARAH O'DONNELL",0,8*a++),r.setColor(2).addText("ENDING ILLUSTRATIONS",0,8*a++),a++,a++,r.addText(" MADE WITH PIXELBOX",0,8*a++),r.addText("  AND FAMITRACKER",0,8*a++),a++,a++,r.setColor(1).addText(" THANKS FOR PLAYING ",0,8*a++),i.open=function(){camera(0,0),paper(3).cls(),draw(r.texture,0,0)},i.update=function(){var t=n();t.btnp.A&&s.open("title"),t.btnp.B&&s.open("title"),t.btnp.start&&s.open("title")}},{"../TextBox":17,"../gamepad":29,"../viewManager":45}],36:[function(t,e,i){var n=t("../TextBox"),s=t("../viewManager"),o=15,r=[[{img:null,duration:4},{img:assets.illustrations.monkeyReunion2,duration:1},{img:assets.illustrations.monkeyReunion1,duration:1},{img:assets.illustrations.monkeyReunion0,duration:30},{img:assets.illustrations.monkeyReunion1,duration:1},{img:assets.illustrations.monkeyReunion2,duration:1},{img:null,duration:2}],[{img:null,duration:4},{img:assets.illustrations.monkeyStorytime2,duration:1},{img:assets.illustrations.monkeyStorytime1,duration:1},{img:assets.illustrations.monkeyStorytime0,duration:30},{img:assets.illustrations.monkeyStorytime1,duration:1},{img:assets.illustrations.monkeyStorytime2,duration:1},{img:null,duration:8},{img:null,duration:1}]],a=new n(160,24,assets.font.tetris).setColor(0);a.addText("      THE END.",0,0),a.addText(" THANKS FOR PLAYING",0,16);var h=0,u=0,l=0,d=!1;i.open=function(t){t=t||{},d=!!t.speedrun,h=0,camera(0,0),paper(0).cls()},i.update=function(){if(h-=1,!(h>0)){var t=r[u][l];if(h=t.duration*o,t.img?draw(t.img,0,0):paper(0).cls(),l+=1,l>=r[u].length&&(l=0,u+=1,u>=r.length)){if(d)return s.open("speedrunResult");draw(a.texture,0,64),h=1/0}}}},{"../TextBox":17,"../viewManager":45}],37:[function(t,e,i){function n(){I=0,L=0,k=0,E=0}function o(t,e,i){d.layer.draw(assets.entity.doors[e+i],t[e].x*g-8,t[e].y*v-8)}function r(){n(),j=[],z=[];var t=assets.levels[B];if(!t)return B=0,void h.open("ending",{speedrun:D});var e=t.music;if(null===e)audioManager.stopLoopSound("sfx");else if(e){var s=assets.music[e];audioManager.playLoopSound("sfx",e,1,0,0,s.start,s.end)}if(t.intermission)return B+=1,void h.open("intermission",t);c.setLevel(B),d.load(t.id),_=t.paper,A=t.parallax;var r=d.getEntryPoints(),a=t.doorType||1;o(r,"entry",a),o(r,"exit",a),V=r.needKey,R=d.width*g-f,P=d.height*v-y,T.x=r.entry.x*g,T.y=r.entry.y*v,M=clip(T.x-m,0,R),C=clip(T.y-x,0,P),i.updateHealthHUD()}var a=t("Texture"),h=t("../viewManager"),u=t("../gamepad").getAnyGamepad,l=t("../Monkey"),d=t("../level"),p=t("../TextBox"),c=t("../speedrun"),f=settings.screen.width,y=settings.screen.height,g=settings.tileSize[0],v=settings.tileSize[0],m=~~(f/2)-4,x=~~(y/2)-4,w=.1,S=.35,b=.85,T=i.monkey=new l,_=0,A=1,M=0,C=0,I=0,L=0,k=0,E=0,B=0,R=0,P=0,V=!1,j=[],z=[],O=!1,G=0,F=new p(160,8,assets.font.tetris).setColor(3);F.paper=3;var N=new a(160,8),D=!1;c.reset(),i.shakeCamera=function(t){k=t,E=2*t*(Math.random()-.5)},i.getLevel=function(){return assets.levels[B]},i.isSpeedrunEnabled=function(){return D},i.open=function(t){t=t||{},t.resume||(void 0!==t.speedrun&&(D=t.speedrun),void 0!==t.level&&(B=t.level),r())},i.respawn=function(){T.reset(),r()},i.gotoNextLevel=function(){return V&&!T.hasKey?(i.displayMessage(" THE DOOR IS LOCKED"),void sfx("wrong")):(T.reset(),B+=1,void r())},i.update=function(){var t=u();if(t.btnp.start)return void h.open("pause");paper(_).cls(),T.update(t);var e=clip(T.x-m,0,R),i=clip(T.y-x,0,P),n=e-M;n>-1&&n<1?M=e:M+=n*w,C+=(i-C)*w,k-=I*S,E-=L*S,k*=b,E*=b,I+=k,L+=E;var s=M+I,o=C+L;camera(s*A,o*A),d.drawBackground(),camera(s,o),d.draw(),T.draw();for(var r=0;r<j.length;r++)j[r].draw();for(var r=0;r<z.length;r++)T.checkCollisionWithEntity(z[r]);camera(0,0),D&&(c.update(),c.draw()),O?(draw(F.texture,0,136),--G<=0&&(O=!1)):draw(N,0,136)},i.addEntity=function(t,e){j.push(t),e&&z.push(t)},i.removeEntityFromCollisions=function(t){index=z.indexOf(t),index!==-1&&z.splice(index,1)},i.removeEntity=function(t){var e=j.indexOf(t);e!==-1&&j.splice(e,1),i.removeEntityFromCollisions(t)},i.displayMessage=function(t){O=!0,G=80,F.cls(),F.addText(t,0,0)},i.updateHealthHUD=function(){N.clear();for(var t=0;t<T.maxLife;t++)s=t<T.lifePoints?assets.hud.healthFull:assets.hud.healthEmpty,N.draw(s,1+5*t,0)}},{"../Monkey":14,"../TextBox":17,"../gamepad":29,"../level":30,"../speedrun":33,"../viewManager":45,Texture:1}],38:[function(t,e,i){var n=t("../gamepad").getAnyGamepad,s=t("./gameView"),o=t("../viewManager"),r=t("../TextBox"),a=settings.tileSize[1],h=getMap("fondu"),u=new r(160,8,assets.font.tetris).setColor(0),l=new r(160,8,assets.font.tetris).setColor(0);u.addText("     GAME OVER",0,0),l.addText("      RETRY ?",0,0);var d=0;i.open=function(t){d=0},i.update=function(){if(camera(0,0),d+=1,d<=40)return draw(h,0,(d-h.height)*a),void draw(h,0,(18-d)*a,!1,!0);draw(u.texture,0,56),draw(l.texture,0,72);var t=n();(t.btnp.A||t.btnp.B||t.btnp.start)&&(s.respawn(),o.open("game"))}},{"../TextBox":17,"../gamepad":29,"../viewManager":45,"./gameView":37}],39:[function(t,e,i){var n=t("../gamepad").getAnyGamepad,s=t("../viewManager"),o=t("../TextBox"),r=new o(160,24,assets.font.tetris).setColor(3),a=0;i.open=function(t){t=t||{},r.clear(),r.addText("CHAPTER "+t.chapter,8,0),r.addText(t.title,8,16),camera(0,0),paper(3).cls(),draw(r.texture,0,64),a=0},i.update=function(){if(++a<10)return camera(0,0),paper(3).cls(),void draw(r.texture,0,64);var t=n();(a>=150||t.btnp.A||t.btnp.B||t.btnp.start)&&s.open("game")}},{"../TextBox":17,"../gamepad":29,"../viewManager":45}],40:[function(t,e,i){var n=t("../viewManager"),s=t("../gamepad").getAnyGamepad,o=t("../passGrid"),r=t("../TextBox"),a={},h=settings.tileSize[0],u=settings.tileSize[1],l=52,d=44,p=getMap("passBG"),c=p.width*h,f=[assets.hud.target.f0,assets.hud.target.f1,assets.hud.target.f1];
ANIMATION_SPEED=.1;var y=new r(8*h,u,assets.font.tetris).setColor(0);y.addText("PASSWORD",0,0),function(){for(var t=assets.levels,e=0;e<t.length;e++){var i=t[e];i.password&&(a[i.password]=e)}}();var g={x:0,y:0,frame:0},v=new o,m=0;i.open=function(){camera(0,0),paper(1).cls()},i.update=function(){var t=s();if(t.btnp.right&&(g.x=(g.x+1)%5),t.btnp.left&&(g.x=(g.x+4)%5),t.btnp.down&&(g.y=(g.y+1)%5),t.btnp.up&&(g.y=(g.y+4)%5),t.btnp.A&&v.switchBit(g.x,g.y),t.btnr.B){var e=v.getPassword(),i=a[e];i?n.open("game",{level:i}):(sfx("wrong"),console.log(e))}t.btnp.start&&n.open("title"),g.frame+=ANIMATION_SPEED,g.frame>=f.length&&(g.frame=0),m+=.5,m>=c&&(m=0),cls(),draw(p,m,0),draw(p,m-c,0),draw(y.texture,48,32),v.draw(l,d),draw(f[~~g.frame],g.x*h+l+4,g.y*u+d+4)}},{"../TextBox":17,"../gamepad":29,"../passGrid":32,"../viewManager":45}],41:[function(t,e,i){var n=t("./gameView"),s=t("../gamepad").getAnyGamepad,o=t("../viewManager"),r=t("../TextBox"),a=t("../passGrid"),h=new a,u=!1,l=0,d=new r(40,8,assets.font.tetris).setColor(0);d.addText("PAUSE",0,0),i.open=function(t){l=5,t=t||{},u=!1;var e=n.getLevel();e.password&&(h.setPassword(e.password),u=!0)},i.update=function(){if(l>1)return paper(1).pen(1),camera(0,0),rectfill(8*l,8*l,160-16*l,144-16*l),void(l-=1);draw(d.texture,60,32),u&&h.draw(52,56);var t=s();t.btnp.start&&o.open("game",{resume:!0})}},{"../TextBox":17,"../gamepad":29,"../passGrid":32,"../viewManager":45,"./gameView":37}],42:[function(t,e,i){function n(t){l.cls(),l.addText("RESULT",56,0),l.addText("STAGE   TIME    TRY",0,16);for(var e=t,i=0,n=d.levels;i<u&&e<n.length;){var s=n[e];e+=1,i+=1,s.data.intermission?l.addText(s.data.title,0,8*i+24):l.addText((" "+s.data.stage).slice(-2)+"   "+s.getTime()+"  "+h+"*"+s.death,8,8*i+24)}var o=d.total;l.addText("TOTAL "+o.getTime()+"  "+h+"*"+o.death,0,136),draw(l.texture,0,0)}function s(){p+=u,p>=d.levels.length&&(p=0),n(p)}var o=t("../TextBox"),r=t("../speedrun"),a=t("../gamepad"),h=chr$(64),u=11,l=new o(160,144,assets.font.tetris).setColor(3);l.paper=3;var d,p=0;i.open=function(t){camera(0,0),d=r.getResult(),n(p)},i.update=function(){var t=a.getAnyGamepad();t.btnp.A&&s(),t.btnp.B&&s(),t.btnp.start&&s()}},{"../TextBox":17,"../gamepad":29,"../speedrun":33}],43:[function(t,e,i){var n=t("../viewManager"),s=assets.icon.pixelbox,o=0;i.open=function(){o=-s.height,paper(3),audioManager.loadSound("logo")},i.update=function(){return o+=.5,cls(),o>=130?n.open("title"):void(o>=125||(64==o&&sfx("logo"),draw(s,32,Math.min(o,64))))}},{"../viewManager":45}],44:[function(t,e,i){function n(){var t=0;x.clear(),x.addText("START GAME",0,8*t++),x.addText("SPEEDRUN:"+(m?"ON":"OFF"),0,8*t++),x.addText("PASSWORD",0,8*t++),x.addText("CREDITS",0,8*t++)}function s(t){t.sx+=(t.ax-t.x)*T,t.sy+=(t.ay-t.y)*T,t.sx*=_,t.sy*=_,t.x+=t.sx,t.y+=t.sy}function o(){switch(v){case 0:r.open("game",{levelId:0,speedrun:m});break;case 1:m=!m,n();break;case 2:r.open("password");break;case 3:r.open("credit")}}var r=t("../viewManager"),a=t("../TextBox"),h=t("../gamepad"),u=settings.screen.height,l=4,d=88,p=getMap("title/background"),c=assets.icon.monkey,f=assets.icon.warp,y=assets.hud.cursor,g=0,v=0,m=!1,x=new a(128,32,assets.font.tetris).setColor(3),w=new a(128,8,assets.font.tetris).setColor(3);w.addText("  STK & CO 2016",0,0);var S={x:0,y:0,sx:0,sy:0,ax:16,ay:20},b={x:0,y:0,sx:0,sy:0,ax:36,ay:40},T=.01,_=.95;i.open=function(){S={x:-150,y:10,sx:0,sy:-2,ax:16,ay:20},b={x:190,y:-20,sx:0,sy:2,ax:36,ay:40},camera(0,0),paper(2),n();var t=assets.music.title;audioManager.playLoopSound("sfx","title",1,0,0,t.start,t.end)},i.update=function(){cls(),++g>u&&(g=0),draw(p,0,g),draw(p,0,g-u),s(S),s(b),draw(c,S.x,S.y),draw(f,b.x,b.y),draw(x.texture,40,d),draw(y,32,8*v+d),draw(w.texture,16,136);var t=h.getAnyGamepad();t.btnp.down&&(v+=1,v>=l&&(v=0)),t.btnp.up&&(v-=1,v<0&&(v=l-1)),t.btnp.A&&o(),t.btnp.B&&o(),t.btnp.start&&o(),1===v&&t.btnp.right&&(m=!m,n()),1===v&&t.btnp.left&&(m=!m,n())}},{"../TextBox":17,"../gamepad":29,"../viewManager":45}],45:[function(t,e,i){var n={};i.view=null,i.addView=function(t,e){n[t]=e},i.open=function(t,e){var s=n[t];return s?(i.view=s,void(s.open&&s.open(e))):console.error("view does not exist",t)},i.update=function(){i.view.update()}},{}],46:[function(t,e,i){function n(t){if(u===setTimeout)return setTimeout(t,0);try{return u(t,0)}catch(e){try{return u.call(null,t,0)}catch(e){return u.call(this,t,0)}}}function s(t){if(l===clearTimeout)return clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function o(){f&&p&&(f=!1,p.length?c=p.concat(c):y=-1,c.length&&r())}function r(){if(!f){var t=n(o);f=!0;for(var e=c.length;e;){for(p=c,c=[];++y<e;)p&&p[y].run();y=-1,e=c.length}p=null,f=!1,s(t)}}function a(t,e){this.fun=t,this.array=e}function h(){}var u,l,d=e.exports={};!function(){try{u=setTimeout}catch(t){u=function(){throw new Error("setTimeout is not defined")}}try{l=clearTimeout}catch(t){l=function(){throw new Error("clearTimeout is not defined")}}}();var p,c=[],f=!1,y=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new a(t,e)),1!==c.length||f||n(r)},a.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=h,d.addListener=h,d.once=h,d.off=h,d.removeListener=h,d.removeAllListeners=h,d.emit=h,d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],47:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],48:[function(t,e,i){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],49:[function(t,e,i){(function(e,n){function s(t,e){var n={seen:[],stylize:r};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),y(e)?n.showHidden=e:e&&i._extend(n,e),S(n.showHidden)&&(n.showHidden=!1),S(n.depth)&&(n.depth=2),S(n.colors)&&(n.colors=!1),S(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),h(n,t,n.depth)}function o(t,e){var i=s.styles[e];return i?"["+s.colors[i][0]+"m"+t+"["+s.colors[i][1]+"m":t}function r(t,e){return t}function a(t){var e={};return t.forEach(function(t,i){e[t]=!0}),e}function h(t,e,n){if(t.customInspect&&e&&M(e.inspect)&&e.inspect!==i.inspect&&(!e.constructor||e.constructor.prototype!==e)){var s=e.inspect(n,t);return x(s)||(s=h(t,s,n)),s}var o=u(t,e);if(o)return o;var r=Object.keys(e),y=a(r);if(t.showHidden&&(r=Object.getOwnPropertyNames(e)),A(e)&&(r.indexOf("message")>=0||r.indexOf("description")>=0))return l(e);if(0===r.length){if(M(e)){var g=e.name?": "+e.name:"";return t.stylize("[Function"+g+"]","special")}if(b(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(_(e))return t.stylize(Date.prototype.toString.call(e),"date");if(A(e))return l(e)}var v="",m=!1,w=["{","}"];if(f(e)&&(m=!0,w=["[","]"]),M(e)){var S=e.name?": "+e.name:"";v=" [Function"+S+"]"}if(b(e)&&(v=" "+RegExp.prototype.toString.call(e)),_(e)&&(v=" "+Date.prototype.toUTCString.call(e)),A(e)&&(v=" "+l(e)),0===r.length&&(!m||0==e.length))return w[0]+v+w[1];if(n<0)return b(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special");t.seen.push(e);var T;return T=m?d(t,e,n,y,r):r.map(function(i){return p(t,e,n,y,i,m)}),t.seen.pop(),c(T,v,w)}function u(t,e){if(S(e))return t.stylize("undefined","undefined");if(x(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return m(e)?t.stylize(""+e,"number"):y(e)?t.stylize(""+e,"boolean"):g(e)?t.stylize("null","null"):void 0}function l(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,i,n,s){for(var o=[],r=0,a=e.length;r<a;++r)E(e,String(r))?o.push(p(t,e,i,n,String(r),!0)):o.push("");return s.forEach(function(s){s.match(/^\d+$/)||o.push(p(t,e,i,n,s,!0))}),o}function p(t,e,i,n,s,o){var r,a,u;if(u=Object.getOwnPropertyDescriptor(e,s)||{value:e[s]},u.get?a=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(a=t.stylize("[Setter]","special")),E(n,s)||(r="["+s+"]"),a||(t.seen.indexOf(u.value)<0?(a=g(i)?h(t,u.value,null):h(t,u.value,i-1),a.indexOf("\n")>-1&&(a=o?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n"))):a=t.stylize("[Circular]","special")),S(r)){if(o&&s.match(/^\d+$/))return a;r=JSON.stringify(""+s),r.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(r=r.substr(1,r.length-2),r=t.stylize(r,"name")):(r=r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),r=t.stylize(r,"string"))}return r+": "+a}function c(t,e,i){var n=0,s=t.reduce(function(t,e){return n++,e.indexOf("\n")>=0&&n++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return s>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}function f(t){return Array.isArray(t)}function y(t){return"boolean"==typeof t}function g(t){return null===t}function v(t){return null==t}function m(t){return"number"==typeof t}function x(t){return"string"==typeof t}function w(t){return"symbol"==typeof t}function S(t){return void 0===t}function b(t){return T(t)&&"[object RegExp]"===I(t)}function T(t){return"object"==typeof t&&null!==t}function _(t){return T(t)&&"[object Date]"===I(t)}function A(t){return T(t)&&("[object Error]"===I(t)||t instanceof Error)}function M(t){return"function"==typeof t}function C(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function I(t){return Object.prototype.toString.call(t)}function L(t){return t<10?"0"+t.toString(10):t.toString(10)}function k(){var t=new Date,e=[L(t.getHours()),L(t.getMinutes()),L(t.getSeconds())].join(":");return[t.getDate(),V[t.getMonth()],e].join(" ")}function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var B=/%[sdj%]/g;i.format=function(t){if(!x(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(s(arguments[i]));return e.join(" ")}for(var i=1,n=arguments,o=n.length,r=String(t).replace(B,function(t){if("%%"===t)return"%";if(i>=o)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}}),a=n[i];i<o;a=n[++i])r+=g(a)||!T(a)?" "+a:" "+s(a);return r},i.deprecate=function(t,s){function o(){if(!r){if(e.throwDeprecation)throw new Error(s);e.traceDeprecation?console.trace(s):console.error(s),r=!0}return t.apply(this,arguments)}if(S(n.process))return function(){return i.deprecate(t,s).apply(this,arguments)};if(e.noDeprecation===!0)return t;var r=!1;return o};var R,P={};i.debuglog=function(t){if(S(R)&&(R=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!P[t])if(new RegExp("\\b"+t+"\\b","i").test(R)){var n=e.pid;P[t]=function(){var e=i.format.apply(i,arguments);console.error("%s %d: %s",t,n,e)}}else P[t]=function(){};return P[t]},i.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},i.isArray=f,i.isBoolean=y,i.isNull=g,i.isNullOrUndefined=v,i.isNumber=m,i.isString=x,i.isSymbol=w,i.isUndefined=S,i.isRegExp=b,i.isObject=T,i.isDate=_,i.isError=A,i.isFunction=M,i.isPrimitive=C,i.isBuffer=t("./support/isBuffer");var V=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];i.log=function(){console.log("%s - %s",k(),i.format.apply(i,arguments))},i.inherits=t("inherits"),i._extend=function(t,e){if(!e||!T(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t}}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":48,_process:46,inherits:47}],50:[function(t,e,i){function n(){for(var t=0;t<v;t++)c[g[t]]=!1,f[g[t]]=!1}function s(t,e){var i=y[t];i&&(e&&!p[i]&&(c[i]=!0),!e&&p[i]&&(f[i]=!0),p[i]=e)}function o(t,e,i){var n=new m(t,e),s=n.canvas;document.body.appendChild(s);var o=s.style;return o.width=t*i[0]+"px",o.height=e*i[1]+"px",n}function r(e,i){function s(){o.update(),n(),b(s)}if(paper(0).pen(1).cls(),e)return print(e),console.error(e);window.assets=i,i.tilesheet&&tilesheet(i.tilesheet),x.loadBank(i.maps);var o=t("../src/main.js");o.update&&(n(),s())}function a(t,e,i,n){rectfill(T-_,A-2,~~(n*_*2),4)}var h=t("../settings.json");window.settings=h;var u=t("assetLoader");window.inherits=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})};var l=t("audio-manager"),d=window.audioManager=new l(["sfx"]);d.settings.audioPath="audio/",d.settings.defaultFade=.3,d.init(),d.setVolume("sfx",1),window.sfx=function(t,e,i,n){d.playSound("sfx",t,e,i,n)},window.music=function(t,e){return t?void d.playLoopSound("sfx",t,e):void d.stopLoopSound("sfx")};var p=window.btn={},c=window.btnp={},f=window.btnr={},y={},g=[],v=0;!function(){var t=h.controls||{up:38,down:40,left:37,right:39,A:32,B:88};for(var e in t){var i=t[e];y[i]=e,p[e]=!1,c[e]=!1,f[e]=!1,g.push(e)}v=g.length}(),window.addEventListener("keydown",function(t){t.preventDefault(),s(t.keyCode,!0)}),window.addEventListener("keyup",function(t){t.preventDefault(),s(t.keyCode,!1)}),window.chr$=function(t){return String.fromCharCode(t)},window.clip=function(t,e,i){return Math.max(e,Math.min(i,t))},window.random=function(t){return~~Math.round(t*Math.random())};var m=t("Texture"),x=t("TileMap");window.texture=function(t){var e=new m(t.width,t.height);return e.ctx.drawImage(t,0,0),e},window.tilesheet=function(t){return m.prototype.setGlobalTilesheet(t)};var w=window.$screen=o(h.screen.width,h.screen.height,h.screen.pixelSize);w.setPalette(h.palette),window.cls=function(){return w.cls()},window.sprite=function(t,e,i,n,s,o){return w.sprite(t,e,i,n,s,o)},window.draw=function(t,e,i,n,s,o){return w.draw(t,e,i,n,s,o)},window.rect=function(t,e,i,n){return w.rect(t,e,i,n)},window.rectfill=function(t,e,i,n){return w.rectfill(t,e,i,n)},window.camera=function(t,e){return w.setCamera(t,e)},window.pen=function(t){return w.pen(t)},window.paper=function(t){return w.paper(t)},window.locate=function(t,e){return w.locate(t,e)},window.print=function(t,e,i){return w.print(t,e,i)},window.println=function(t){return w.println(t)},window.getMap=x.getMap;var S=1/60,b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,S)},T=~~(h.screen.width/2),_=~~(h.screen.width/4),A=~~(h.screen.height/2),M=h.loaderColors||[0,1];Array.isArray(M)||(M=[0,1]);var C=~~M[0],I=~~M[1];paper(C).cls().paper(I).pen(I),rect(T-_-2,A-4,2*_+4,8),u.preloadStaticAssets(r,a)},{"../settings.json":11,"../src/main.js":31,Texture:1,TileMap:2,assetLoader:3,"audio-manager":5}]},{},[50]);